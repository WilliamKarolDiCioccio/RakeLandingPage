---
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import RakeScreenshot from "../images/RakeScreenshot.webp";
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<div
  class="w-lvh mt-4 flex flex-col items-center md:mt-8"
  data-aos="fade-up"
  data-aos-delay="250"
>
  <div class="m-12">
    <div
      id="fullscreen-image-container"
      class="relative shadow-xl transition-transform hover:scale-105 hover:shadow-2xl"
    >
      <Image
        class="aspect-video select-none rounded-xl"
        src={RakeScreenshot}
        width={RakeScreenshot.width / 2}
        densities={[1.5, 2]}
        alt="screenshot"
      />
      <button
        id="fullscreen-button"
        class="text-md absolute bottom-0 right-0 flex flex-row items-center rounded-br-xl rounded-tl-xl bg-black bg-opacity-50 text-white"
      >
        <span class="ml-3 mr-1">{t("splash.Fullscreen")}</span>
        <Icon class="ml-1 mr-1 select-none" name="mdi:fullscreen" />
      </button>
    </div>
    <p class="mt-6 text-center italic text-gray-400">
      A screenshot of a test scene from Rake Engine
    </p>
  </div>
  <a
    href="https://github.com/WilliamKarolDiCioccio/Rake/releases"
    target="_blank"
    referrerpolicy="no-referrer"
    aria-label={t("splash.Download")}
  >
    <button
      class="flex h-12 flex-row items-center rounded-lg bg-gradient-to-t from-red-500 to-orange-500 text-white shadow-lg shadow-orange-500/50 transition-transform text-lg hover:scale-110"
    >
      <span class="ml-3 mr-1">{t("splash.Download")}</span>
      <Icon class="ml-1 mr-1 select-none" name="mdi:download" />
      <span
        class="ml-1 mr-3 inline-flex items-center justify-center rounded-full bg-red-600 px-2 py-1 font-bold leading-none text-white text-xs"
        >{t("common.Unavailable")}</span
      >
    </button>
  </a>
  <br />
  <a
    href="https://github.com/WilliamKarolDiCioccio/Rake.git"
    target="_blank"
    referrerpolicy="no-referrer"
    aria-label={t("splash.CloneSource")}
  >
    <button
      class="flex h-12 flex-row items-center rounded-lg bg-gradient-to-t from-blue-500 to-cyan-500 text-white shadow-lg shadow-cyan-500/50 transition-transform text-lg hover:scale-110"
    >
      <span class="ml-3 mr-1">{t("splash.CloneSource")}</span>
      <Icon class="ml-1 mr-1 select-none" name="mdi:file" />
      <span
        class="ml-1 mr-3 inline-flex items-center justify-center rounded-full bg-green-600 px-2 py-1 font-bold leading-none text-white text-xs"
        >{t("common.Available")}</span
      >
    </button>
  </a>
</div>

<script lang="ts" is:inline>
  const downloadButton = document.getElementById("download-button");
  const cloneSourceButton = document.getElementById("clone-source-button");

  downloadButton.addEventListener("click", () => {
    gtag("event", "download_button_click", {
      event_category: "Button Click",
      event_label: "Download Button Clicked",
    });
  });

  cloneSourceButton.addEventListener("click", () => {
    gtag("event", "clone_source_button_click", {
      event_category: "Button Click",
      event_label: "Clone Source Button Clicked",
    });
  });

  const fullscreenButton = document.getElementById("fullscreen-button");
  const imageContainer = document.getElementById("fullscreen-image-container");

  console.log(fullscreenButton);

  fullscreenButton.addEventListener("click", () => {
    if (imageContainer.requestFullscreen) {
      imageContainer.requestFullscreen();
    } else if (imageContainer.webkitRequestFullscreen) {
      imageContainer.webkitRequestFullscreen();
    } else if (imageContainer.msRequestFullscreen) {
      imageContainer.msRequestFullscreen();
    }
  });

  document.addEventListener("fullscreenchange", () => {
    if (document.fullscreenElement === imageContainer) {
      imageContainer.style.width = "100lvw";
      imageContainer.style.height = "100lvh";
      imageContainer.style.overflow = "hidden";
      imageContainer.style.backgroundSize = "cover";
    } else {
      imageContainer.style.width = "";
      imageContainer.style.height = "";
      imageContainer.style.overflow = "";
      imageContainer.style.backgroundSize = "";
    }
  });
</script>
